@model BibliotekaOnline.Models.Borrowing
@{
    ViewData["Title"] = "Dodaj wypoÅ¼yczenie";
}

<div class="modern-header">
    <h2>â• Dodaj wypoÅ¼yczenie</h2>
    <p>UtwÃ³rz nowe wypoÅ¼yczenie dla uÅ¼ytkownika</p>
</div>

@if (TempData["Error"] != null)
{
    <div class="modern-alert modern-alert-danger">
        âŒ @TempData["Error"]
    </div>
}

<div class="modern-card">
    <form method="post">
        <div class="modern-form-group">
            <label class="modern-label">
                ğŸ‘¤ UÅ¼ytkownik
            </label>
            <select name="UserId" class="modern-input" required>
                <option value="">-- Wybierz uÅ¼ytkownika --</option>
                @foreach (var user in ViewBag.Users)
                {
                    <option value="@user.Id">@user.Email</option>
                }
            </select>
        </div>

        <div class="modern-form-group">
            <label class="modern-label">
                ğŸ“– KsiÄ…Å¼ka
            </label>
            <select name="BookId" class="modern-input" required onchange="updateBookStatus(this)">
                <option value="">-- Wybierz ksiÄ…Å¼kÄ™ --</option>
                @foreach (var book in ViewBag.Books)
                {
                    <option value="@book.Id" data-copies="@book.TotalCopies">@book.Title - @book.Author</option>
                }
            </select>
            <div id="bookStatus" class="mt-2"></div>
        </div>

        <div class="info-box">
            <h6>ğŸ“‹ Informacje:</h6>
            <div class="d-flex align-items-center mb-2">
                <span class="me-2">ğŸ“…</span>
                <span>Data wypoÅ¼yczenia: <strong>@DateTime.Now.ToString("dd.MM.yyyy")</strong></span>
            </div>
            <div class="d-flex align-items-center">
                <span class="me-2">â°</span>
                <span>Termin zwrotu: <strong>@DateTime.Now.AddDays(14).ToString("dd.MM.yyyy")</strong> (14 dni)</span>
            </div>
        </div>

        <div class="d-flex gap-3 justify-content-center mt-4">
            <button type="submit" class="modern-btn" id="submitButton">
                âœ… UtwÃ³rz wypoÅ¼yczenie
            </button>
            <a asp-action="AdminPanel" class="modern-btn modern-btn-outline">
                âŒ Anuluj
            </a>
        </div>
    </form>
</div>

<div class="modern-card">
    <div class="success-box">
        <h6>ğŸ’¡ WskazÃ³wki:</h6>
        <ul class="mb-0">
            <li>Wybierz uÅ¼ytkownika z listy zarejestrowanych</li>
            <li>Wybierz dostÄ™pnÄ… ksiÄ…Å¼kÄ™ z katalogu</li>
            <li>Standardowy okres wypoÅ¼yczenia to 14 dni</li>
            <li>Status wypoÅ¼yczenia bÄ™dzie automatycznie ustawiony jako aktywne</li>
        </ul>
    </div>
</div>

@section Scripts {
    <script>
        function updateBookStatus(select) {
            const bookStatus = document.getElementById('bookStatus');
            const submitButton = document.getElementById('submitButton');
            const selectedOption = select.options[select.selectedIndex];
            const copies = parseInt(selectedOption.dataset.copies);

            if (copies > 0) {
                bookStatus.innerHTML = `
                    <div class="alert alert-success">
                        <i class="bi bi-check-circle"></i> KsiÄ…Å¼ka dostÄ™pna do wypoÅ¼yczenia
                        <span class="badge bg-success ms-2">${copies} egzemplarzy</span>
                    </div>`;
                submitButton.disabled = false;
            } else {
                bookStatus.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-x-circle"></i> KsiÄ…Å¼ka niedostÄ™pna - wszystkie egzemplarze sÄ… wypoÅ¼yczone
                    </div>`;
                submitButton.disabled = true;
            }
        }
    </script>
}