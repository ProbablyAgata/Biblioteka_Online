@{
    ViewData["Title"] = "Panel użytkownika";
    var activeBorrowings = ViewBag.ActiveBorrowings as List<BibliotekaOnline.Models.Borrowing> ?? new();
    var recentlyReturned = ViewBag.RecentlyReturned as List<BibliotekaOnline.Models.Borrowing> ?? new();
}

<h2>Witaj w panelu użytkownika!</h2>

<section>
    <h3>Twoje aktualne wypożyczenia</h3>
    @if (activeBorrowings.Count > 0)
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Tytuł</th>
                    <th>Autor</th>
                    <th>Data wypożyczenia</th>
                    <th>Termin zwrotu</th>
                    <th>Akcja</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var borrowing in activeBorrowings)
                {
                    <tr>
                        <td>@borrowing.Book.Title</td>
                        <td>@borrowing.Book.Author</td>
                        <td>@borrowing.BorrowDate.ToString("yyyy-MM-dd")</td>
                        <td>@borrowing.ReturnDate?.ToString("yyyy-MM-dd")</td>
                        <td>
                            <form asp-controller="Borrowings" asp-action="RequestExtension" method="post" style="display:inline;">
                                <input type="hidden" name="borrowingId" value="@borrowing.Id" />
                                <button type="submit" class="btn btn-warning btn-sm">Poproś o wydłużenie</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>Nie masz aktualnie żadnych wypożyczeń.</p>
    }
</section>

<section>
    <h3>Ostatnio zwrócone książki</h3>
    @if (recentlyReturned.Count > 0)
    {
        <table class="table">
            <thead>
                <tr>
                    <th>Tytuł</th>
                    <th>Data wypożyczenia</th>
                    <th>Data zwrotu</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var borrowing in recentlyReturned)
                {
                    <tr>
                        <td>@borrowing.Book.Title</td>
                        <td>@borrowing.BorrowDate.ToString("yyyy-MM-dd")</td>
                        <td>@borrowing.ReturnDate?.ToString("yyyy-MM-dd")</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p>Nie masz jeszcze historii zwrotów.</p>
    }
</section>

<section class="mt-4">
    <a class="btn btn-primary" href="@Url.Action("Index", "Books")">Zarezerwuj książkę (przeglądaj katalog)</a>
    <a class="btn btn-secondary" href="/Identity/Account/Manage">Edycja konta</a>
    <form asp-controller="Account" asp-action="Logout" method="post" style="display:inline;">
        <button type="submit" class="btn btn-danger">Wyloguj</button>
    </form>
</section>
